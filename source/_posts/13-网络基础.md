---
title: 13.网络基础
date: 2020-06-15 13:07:53
layout:
updated:
comments:
categories:
tags:
---
计算机网络基础、

CCNA

IPV4:32位

IPV6:128位



通信时,进程的数字标识

16bit

0-65535:1-65535

1-1023：固定分配，只有管理员有权限启用；

1024-4W：半固定

4W+: 临时



进程地址：

IP：port，socket

MAC：本地通信，范围，本地局域网

IP：界定通信主机，源和目标主机；范围：互联网；

port：界定进程，范围：主机

​					OSI									TCP（事实标准）

资源子网：应用层								应用层

​					表示层

​					会话层

通信子网：传输层							传输层

​					网络层							网络层

​					数据链路层					物理层

​					物理层							



OS：

用户空间：应用提供资源

内核空间：进程调度，内存分配，网络功能（TCP协议栈）

端口由内核分配



路由表：

* 静态学习
* 动态学习：rlp2，ospf

路由条目：

* 目标地址 下一跳（nexthop）
* 主机路由
* 网络路由
* 默认路由

优先选择匹配范围最小的



将一台Linux主机接入到网络中实现网络通信：

* IP/MASK：本地通信；
* 路由：跨网络通信；
* DNS服务器地址：基于主机名的通信；
  * 主dns服务器
  * 次dns服务器
  * 第三备用dns服务器
* 配置方式
  * 动态分配DHCP
  * 静态分配
  * ifcfg家族
    * ifconfig：配置ip，netmask
    * route：路由
    * netstat：状态及统计数据查看
  * iproute2家族：-->in OBJECT：
    * addr：地址和掩码
    * link：接口
    * route：路由
    * ss：状态及统计数据查看
  * Centos7：NM（NetworkManager）家族
    * nmcli：命令行工具
    * nmtui：text window工具
  * 注意：
    * DNS服务器的指定-->配置文件：/etc/resolv.conf
    * 主机名：
      * hostname
      * 配置文件：/etc/sysconfig/network
      * Centos7：hostnamectl
  * 配置文件：
    * Redhat及相关发行版
      * /etc/sysconfig/network-scripts/ifcfg-NETCARD_NAME





网卡接口命名方式：

* 传统命名：

  * 以太网：ethx,[0,oo],例如eth0,rth1...
  * PPP网络：pppx[0,...]，例如：ppp0,ppp1，...

* 可预测命名方案（Centos）：

  * 支持多种不同的命名机制：
  * Firmwar，拓扑结构

  1. 如果Firmware或BIOS为主板上集成的设备提供的索引信息可用，则根据此索引进行命名，如eno1，eno2，...
  2. 如果Firmware或BIOS为PCI-E扩展槽所提供的索引信息可用，且可预测，则根据此索引进行命名，如ens1，ens2，...
  3. 如果硬件接口的物理位置信息可用，则根据此信息命名，如enp2s0，...
  4. 如果用户显示定义，也可根据MAC地址命名，例如enx122161ab2e10，...
  5. 上述均不可用时，则仍使用传统方式命名；

  命名格式的组成：

  ​	en：ethernet

  ​	wl：wlan

  ​	ww：wwan

  ​	名称类型：

  ​		o\<index>：集成设备的设备索引号；

  ​		s\<slot>：扩展槽的索引号；

  ​		x\<MAC>：基于MAC地址的命名；

  ​		p\<bus>s\<slot>：基于总线及槽的拓扑结构命名；



PDU -->  数据报文 --> 数据帧

协议传输单元

链路层：以太网帧

互联网层：IP报文

以太网帧：MTU（1500）



linux配置命令：

ifcfg命令家族：ifconfig,route,netstat

ifconfig:

UP：激活

MTU：最大传输单元 (Maximum transmission unit)

MULTICAST:多播（组播）

BROADCAST：广播

prefixlen：前缀

txqueuelen：

RX：接收 ：主要关注dropped,overruns这两项；

TX：发送

ether：centos7表示以太网，相当于centos6 HWaddr：MAC地址；

txqueuelen：传输队列长度

EXP:

`ifconfig eth1 192.168.10.100/24 up`

`ifconfig eth1 192.168.10.100 netmask 255.255.255.0`

送往内核中的tcp/ip协议栈，立即生效；

启用混杂模式：

`ifconfig eth1 promisc`

`ifconfig eth1 -promisc`

管理IPV6：

`add addr/prefixlen`

`del addr/prefixlen`

ROUTE命令：

路由类型：

主机路由	目标为单个IP

网络路由	目标为网络主机

默认路由：目标为任意主机

route -n：查看显示路由条目，-n指以数字格式显示，不反解路由条目；

Kernel IP routing table

Destination 	Gateway		Genmask	Flags	Metric	Ref	Use	Iface

`route add -net 10.0.0.0/8 gw 192.168.10.1 dev eth1`

`route add -net 0.0.0.0/0.0.0.0 gw 192.168.10.1 dev eth1`

`route add default gw 192.168.10.1`

`route del -net 10.0.0.0/8 gw 192.168.10.0`

`route del default`



Netstat 命令

显示路由表：netstat -rn

​	-r：显示内核路由表

​	-n：数字格式

显示网络连接：

​	netstat [--tcp|-t] [--udp|-u]

​	-t：tcp相关的连接

​	-u：UDP

​	-w：raw	

​	-l：处于监听的连接

​	-a：所有状态

​	-n：数字格式显示ip和port

​	-e：扩展格式

​	-p：显示进程及PID

常用组合：ntlp。pantu。nta，utp

​	传输层协议：

​	tcp：面向连接的协议。要建立连接，通信完成拆除连接；

​	udp：无连接的协议；直接发送报文；

所有接口

​	netstat -i

指定接口

​	netsrtat -I \<IFACE>



ifup/ifdown 命令

通过配置文件来识别接口并完成配置

/etc/sysconfig/network-scripts/ifcfg-IFACE



hostname命令

查看：hostname

配置：hostname HOSTNAME	 重启失效

Centos7：hostnamectl

```bash
root@testlab:~# hostnamectl --help
hostnamectl [OPTIONS...] COMMAND ...

Query or change system hostname.

  -h --help              Show this help
     --version           Show package version
     --no-ask-password   Do not prompt for password
  -H --host=[USER@]HOST  Operate on remote host
  -M --machine=CONTAINER Operate on local container
     --transient         Only set transient hostname
     --static            Only set static hostname
     --pretty            Only set pretty hostname

Commands:
  status                 Show current hostname settings	#显示当前主机名信息；
  set-hostname NAME      Set system hostname	#设定主机名，永久有效；
  set-icon-name NAME     Set icon name for host
  set-chassis NAME       Set chassis type for host
  set-deployment NAME    Set deployment environment for host
```

配置文件：/etc/sysconfig/network

HOSTNAME=\<HOSTNAME>

此方法不会立即生效，但是会一直有效

配置DNS服务器指向:

配置件：/etxc/resolv.conf

```bash
[root@Centos7 ~]# cat /etc/resolv.conf
# Generated by NetworkManager
search localdomain
nameserver 192.168.1.2	#注意写IP，不能写域名
```

测试DNS（dig、host、nslookup）

dig -t A FQDN

​	FQDN--IP

互联网大多数主机名不支持反解，就是从IP解析到域名

dig -x IP

IP--FQDN



**iproute2家族:**

IP命令:查看，管理，路由，设备，策略路由，隧道

 ip [ OPTIONS ] OBJECT { COMMAND | help }

OBJECT ：命令可简写，只要能唯一识别

link | address | route

ip link：网络设备的配置（add、show、set、delete）

* ip link set  :改便设备运行状态
  * ip link set dev IFACE up/down
  * multicast on/off 开启/关闭多播功能；
  * promisc on/off：启用/关闭混杂模式
  * name:改网卡名（改之前先停用网卡）
  * txqueuelen：队列长度
  * mtu：设置MTU大小，默认1500
  * netns：net namespace，用于将接口移动到指定的网络名称空间去（类似虚拟机）
    * ip netns add 
    * ip netns list
    * ip netns del
    * ip netns exec NAME COMMAAND
* ip link show
* ip link help



**ip address add**

​	ip address add IFADDR dev IFNAME

​	label NAME ：为额外添加的IP地址指明接口别名；

​	[broadcast ADDRESS]：广播地址；会根据IP和NETMASK自动计算得到；

​	[scope SCOPE_VALUE]：global（全局可用）、site（IPV6）、link（接口可用）、host（仅本机可用、内部使用）

**ip address del**

​	ip address delIFADDR dev IFNAME

 **ip address show**

​	[iFACE] ：仅显示指定接口；

ip address flush dev



**ip route add|delete|show |flush|get**

​	ip route add TYPE PREFIX via GW [dev IFACE] [src SOURCE_IP]

exp:

`	ip route add 192.168.0.0/24 via 10.0.0.1 dev eth1`

`	ip route add 192.168.1.0/24 via 192.168.1.128 dev eth1 src 192.168.1.128` （src为本机网卡地址中的其中一个）

​	ip route add default via GW；

`	ip route add default via 192.168.1.2`

**ip route del**

#ip route delete 192.168.1.0/24

**ip route get TYPE PREFIX**

#ip route get 192.168.0.0/24





SS 命令：

* -t ：tcp
* -u：udp
* -w：raw
* -l：listen
* -a：所有状态
* -n：数字格式
* -p：PID和进程
* -e：扩展
* -m：内存用量
* -o：计时器信息

FILTER := [ state STATE-FILTER ] [ EXPRESSION ]：过滤选项

TCP的常见状态：

TCP FSM：

​	LISTEN：监听

​	ESTABLISEHD：建立的连接

​	FIN_WAIT_1：

​	FIN_WAIT_2:

​	SYN_SENT:

​	SYN_RECV:

​	CLOSED:

EXPRESSION:

​	dport=

​	sport=

​		示例：ss -tan state 状态

配置文件：/etx/sysconfig/network-scripts/ifcfg-IFACE

IP/NETMASK/GW/DNS等专属的配置文件：

IFACE：接口名称

路由的相关配置文件：

/etc/sysconfig/network-scripts/route-IFACE

配置文件/etc/sysconfig/network-scripts/ifcfg-IFACE通过大量参数来定义接口的属性；其可通过vim等文本编辑器直接修改，也可以使用专用的命令的进行修改

centos6：system-config-network

centos7：nmtui，nmcli

ifcfg-IFACE配置文件参数：

* DEVICE：设备名称，与IFACE必须保持一致；
* ONBOOT：在系统引导过程中是否激活设备；
* NETBOOT：是否支持网络引导；
* UUID：此设备的唯一标识；
* IPV6INIT：是否初始化IPV6；
* BOOTPROTO=激活此接口时使用什么协议配置接口属性，常用的有dhcp，bootp，static=none；
* TYPE：指定接口类型；
* DNS1~~DNS2：DNS服务器指向；
* DOMAIN：DNS搜索域；
* DEFROUTE：是否默认路由所使用接口；
* GATEWAY：默认网关；
* IPADDR：IP地址；
* NETMASK：子网掩码；Centos7支持使用prefix以长度方式指明子网掩码；
* IPV4_FAILURE_FATAL ：
* USERCTL：是否允许普通用户控制此设备；
* PEERDNS：如果bootproto的值为’dhcp‘，是否允许dhcpserver分配的dns服务器指向覆盖本地手动指定的dns服务器；默认为允许；
* NM_CONTROLLED：是否使用NetworkManager服务来控制接口配置；

网络服务：

​	network

​	NetworkManager

管理网络服务

​	centos6：service SERVICE {start|status|restart|stop}

​	centos7：systemctl {status|start|stop|restart} SERVICE

配置修改以后，如果要生效，需要重启网络服务

centos6：service network restart

centos7：systemctl restart network.service

用到非默认网关路由：/etc/sysconfig/network-scripts/route-IFACE

支持两种配置方式，但是不可混用；

 1. 每行一个路由条目

    ​	TARGET via GW

	2. 每三行一个路由条目：

    ADDRESS#=TARGET

    NETMASK#=MASK

    GATEWAY#=NEXTHOP

ifconfig 也可以添加多个IP地址



1.ifconfig IFACE——LABEL IPADDR/NETMASK

​	IFACE_LABEL：eth0，eth1

为别名添加配置文件：

DEVICE=IFACE_LABEL

BOOTPROTO：网上别名不支持动态获取

static，none；



NMCLI：


