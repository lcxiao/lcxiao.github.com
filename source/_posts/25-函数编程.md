---
title: 25.函数编程
date: 2020-06-27 07:31:41
layout:
updated:
comments:
categories:
tags:
---
多分支if语句
if ；then
elif ；then
。。。
else
fi

case 语句：


示例1：显示一个菜单给用户
cpu）display cpu information
mem)meminfo
disk) diskinfo
quit) quit

要求：
1. 提示用户给出自己的选择
2. 正确的选择给出相应的信息；否则，提示重新选择正确的选项；


case $VARAIBLE in
PAT1)
    分支1
    ;;
PAT2)
    分支2
    ;;
PAT3)
    ...
    ...
*)
    分支n
    ;;
esac

示例：写一个服务框架脚本
1. 此脚本可接受start stop restart status 四个参数之一
2. 如果参数非4者，提示帮助后退出
3. start，则创建lockfile，并显示启动完成；stop，删除lockfile，并显示停止；restart，先删除在创建，而后显示重启完成，status，判断文件是否存在，存在，显示running，不存在显示stopped；


```
#!/bin/bash
#
prog=$(basename $0)
lockfile=/var/lock/subsys/$prog

case $1 in
start)
    if [ -f $lockfile ]; then
        echo "$prog is Running."
    else
        touch $lockfile
        [ $? -eq 0 ] && echo "start $prog finished."
    fi  
    ;;  
stop)
    if [ -f $lockfile ]; then
        rm -f $lockfile
        [ $? -eq 0 ] && echo "stop $prog finished."
    else
        echo "$prog stopped."
    fi  
    ;;  
restart)
    if [ -f $lockfile ]; then
        rm -f $lockfile
        touch $lockfile
        echo "Restarting finished."
    else
        touch -f $lockfile
        echo "start $prog finished."
    fi  
    ;;  
status)
    if [ -f $lockfile ]; then
        echo "Running."
    else
        echo "Stopped."
    fi  
    ;;
*)
    echo "Usage:$0 start|stop|restart|status."
    exit 1
esac
```

函数：function
过程式编程：代码重用
模块化编程
结构化编程

把一段独立功能的代码当做一个整体，并为之一个名字，命名的代码段，此即为函数；

注意：定义函数的代码段不会自动执行，在调用时执行；所谓调用函数；在代码中给定函数名即可；
函数名出现的任何位置，在代码执行时；都会被自动替换为函数代码；

语法1.
    function f_name{
        ...函数体...
    }
语法2.
    f_name{
        ...函数体...
    }

函数的声明周期：每次被调用时创建，返回时终止；
其状态返回结果为函数体中运行的最后一条命令的状态结果；
自定义状态返回值，需要使用return；
retutn [0-255]
0：成功
255：失败

示例：
```
  1 #!/bin/bash
  2 #
  3 username=$1
  4 userinfo() {
  5     if id "$username" &> /dev/null; then
  6         grep "^$username\>" /etc/passwd | cut -d: -f3,7
  7     else
  8         echo "No such user."
  9     fi
 10 }
 11 
 12 username=$1
 13 userinfo
 14 username=$2
 15 userinfo
 ```
 函数返回值：
 函数的执行结果返回值；
1. 使用echo或printf命令进行输出；
2. 函数体中调用的命令的执行结果；

函数的退出状态码：
1. 默认取决于函数体中执行的最后一条命令的退出状态码；
2. 自定义：return

函数可以传递参数：
传递参数给函数：
    在函数体当中，可以使用$1,$2...引用传递给函数的参数；
    在调用函数时，在函数名后面以空白字符分隔给定参数列表即可，例如，testfunc arg1 arg2 arg3 ...

练习：写一个脚本：
使用函数实现ping一个主机来测试在线状态；主机地址通过参数传递给函数：、
测试172.16.1.1-172.16.67.1

练习2：
打印NN乘法表

变量作用域
局部变量：作用域是函数的声明周期；在函数结束时被自动销毁
定义局部变量的方法：local VARAIBLE=VALUE
本地变量：作用域是运行脚本的shell进程的生命周期；因此，其作用范围是当前脚本程序文件；

函数递归：
    函数直接或者间接调用自身；
    10！=10*9！=10*9*8！=10*9*8*7！=...

    
