---
title: 12.sed
date: 2020-06-01 04:27:31
layout:
updated:
comments:
categories:
tags:
---

文本处理三剑客：

sed、awk、grep



SED

不处理源文件，每次读入一行到自己的工作空间（模式空间），处理完成之后输出至标准输出

默认会处理所有行，我们可以指定让他处理匹配到的行

因此；

先读入一行，然后判断是否匹配我们给的PATTERN

匹配到处理

不匹配不做任何处理

pattern space

​	/			\

no				yes

|				/		|

|			/	edit --> stdout

stdout					|

​						hold space



逐行读入，匹配处理

sed [OPTION]... 'script' [input-file]...

* script :地址定界编辑命令（直接写在一起）
* -n 不输出，（读入之后一定会输出stdout，匹配到的会进行编辑）如果不希望输出，使用这个选项，不输出模式空间的内容；
* -e script ; --expression=script :多点编辑
  * sed -e 's@^#[[:space:]]*@@' -e '/^UUID/d' /etc/fstab
* -f  script-file 每行一个编辑命令
* -r --regexp-extended ：支持使用扩展正则表达式
* -i[SUFFIX], --in-place[=SUFFIX] ： 直接编辑源文件

地址定界：

1. 不给地址：空地址，对全文进行编辑
2. 单地址：
   * #：指定行
   * /pattern/：被此模式匹配到的每一行；
3. 地址范围
   * #.# :
   * #,+#:
   * #,/pat1/
     * /pat1/,/pat2/
4. 步进：~
   * 1-2：所有奇数行
   * 2-2：所有偶数行

​	

编辑命令:

d 删除 注意删除的就不会再显示了,因为匹配到的内容被删除了，显示的是未删除的内容

p 显示模式空间中的内容；（如不加-n选项指定行会被显示2遍）

a \text ：在行后面追加文本“text”，支持使用\n添加多行

i \text：在行前面添加文本，支持使用\n插入多行

c \text：把匹配到的行替换为此处指定的文本“text”

w /path/to/somewhere：保存模式空间匹配到的行至指定的文件中；

r /path/from/somefile：读取指定的文件的内容至当前文件被模式匹配到的行后面，文件合并；

=：模式匹配到的行加行号

！：条件取反：格式为地址定界!编辑命令；

s///：查找替换，其分隔符可自行指定。常用s@@@，s###等；

替换标记：

* g：全局
* w /path/to/somefile：将替换成功的结果保存至指定文件中；
* p：显示替换成功的行；

练习1：删除/boot/grub/grub2.cfg文件中所有以空白字符开头的行的行首的所有空白字符；

sed 's@^[[:space:]]\+@@' /boot/grub2/grub.cfg 

练习2：删除/etc/fstab文件中所有以#开头的行的行首的#号以及#号后面的所有空白字符；

sed 's@^#[[:space:]]*@@' /etc/fstab

练习3：输出一个绝对路径给sed，取出其目录，其行为类似dirname

echo "/var/log/messages" | sed 's@[^/]\+\?$@@'

echo "/var/log/messages/" | sed -r 's@[^/]+/?$@@'



高级编辑命令：

* h：把模式空间中的内容覆盖至保持空间中；
* H：把模式空间中的内容追加至保持空间中；
* g：把保持空间中的内容覆盖至模式空间中；
* G：把保持空间中的内容追加至模式空间中；
* x：把模式空间中的内容与保持空间中的内容互换；
* n：覆盖读取匹配到的行的下一行至模式空间中；
* N：追加读取匹配到的行的下一行至模式空间中；
* d：删除模式空间中的行；
* D：删除多行模式空间中的使用行；

示例：

​	sed -n 'n;p' /etc/fstab：显示偶数行；

​	sed '1!G;h;$!d' file：逆序显示；

​	sed '$!N;$!D' /etc/fstab :最后两行;

​	sed '/^$/d;G' file：删除所有空白行，而后为每行后面加一个空白行

​	sed 'n;d' FILE：显示奇数行；

​	sed 'G' file：在原有的每行后面添加空白行，包括原来的空白行



注意：在任何修改系统关键配置文件的时候，记得要先做备份，而且要定期对/etc目录做备份


